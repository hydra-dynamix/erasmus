# Project-Python Script Packager with Cross-Platform `uv` Bootstrap

## Overview

This tool is a **Python script bundler** that packages a project into a **single, standalone executable script**. It recursively gathers `.py` files, merges them into one file, collects all `import` statements, and **bootstraps runtime dependencies using [uv](https://github.com/astral-sh/uv)**.

The final output is a **platform-aware, cross-compatible script** that:

- Works on **Linux, macOS, and Windows**
- **Installs `uv` automatically** if missing
- Infers and installs required packages using `uv add`
- Runs itself using `uv run`
- Requires **no virtual environments, no `requirements.txt`, and no pip**

---

## Goals

- Convert a Python project into a single executable script
- Automatically infer external dependencies from imports
- Use `uv` to install and run dependencies in a temporary env
- Support both Unix (bash) and Windows (batch) execution
- Guarantee zero setup beyond Python and basic tools (`curl`, `winget`)
- Preserve code structure and dependencies between files

---

## Features

| Feature                      | Description                                                     |
| ---------------------------- | --------------------------------------------------------------- |
| Static import parsing        | Detects and de-duplicates imports using `ast`                   |
| Dependency inference         | Resolves which packages are required from imports               |
| Standard lib filtering       | Excludes stdlib modules from `uv add`                           |
| No extra files               | No `venv`, no `requirements.txt`, no pip needed                 |
| Clean CLI                    | Use `python -m packager` to bundle                              |
| Cross-platform bootstrapping | Works with Bash (Linux/macOS) and Batch (Windows)               |
| Single script output         | One file with shell header, dependency install, and Python code |
| Dependency-aware stacking    | Orders files based on import dependencies                       |
| Import categorization        | Groups imports by stdlib, third-party, local, and relative      |
| Comment preservation         | Optionally preserves comments in the output script              |

---

## Architecture

```
packager/
 __main__.py         # CLI interface
 collector.py        # Recursively finds Python files
 parser.py           # Parses imports using AST
 builder.py          # Merges stripped code bodies and imports
 uv_wrapper.py       # Adds OS-aware shell and batch bootstrap
 mapping.py          # Optional import-to-PyPI mapping
 stdlib.py           # Contains stdlib detection for filtering
```

---

## Detailed Component Design

### `collector.py`

```python
def collect_py_files(base_path: str) -> List[str]:
    # Recursively yield all .py files
```

---

### `parser.py`

```python
class ImportSet:
    # Manages categorized imports (stdlib, third-party, local, relative)
    def __init__(self):
        self.stdlib = set()
        self.third_party = set()
        self.local = set()
        self.relative = set()

    def update(self, other: 'ImportSet') -> None:
        # Merge another ImportSet into this one

    def get_all_imports(self) -> Set[str]:
        # Return all imports across all categories

def extract_imports(source: str) -> ImportSet:
    # Uses ast to extract imports and categorize them

def extract_code_body(source: str, preserve_comments: bool = True) -> Tuple[ImportSet, str]:
    # Extracts imports and returns code body with imports removed
```

---

### `mapping.py` (Optional)

```python
# Maps import names to PyPI packages
PYPI_MAP = {
    "cv2": "opencv-python",
    "PIL": "pillow",
}
```

---

### `stdlib.py`

```python
class StdlibDetector:
    # Detects standard library modules
    def __init__(self):
        self.stdlib_modules = set()

    def initialize(self) -> None:
        # Populate stdlib_modules set

    def is_stdlib_module(self, name: str) -> bool:
        # Check if a module is part of the standard library
```

---

### `builder.py`

```python
def analyze_dependencies(files: List[Path]) -> Dict[Path, ImportSet]:
    # Analyzes dependencies between files to determine stacking order

def order_files(dependencies: Dict[Path, ImportSet], files: List[Path]) -> List[Path]:
    # Orders files based on their dependencies

def collect_all_imports(files: List[Union[str, Path]], base_path: Path) -> Tuple[ImportSet, ImportSet, ImportSet]:
    # Collects and categorizes all imports from the given files

def format_imports(stdlib_imports: ImportSet, third_party_imports: ImportSet, local_imports: ImportSet) -> str:
    # Formats imports into a string with proper grouping and sorting

def extract_code_body(source: str, preserve_comments: bool = True) -> Tuple[ImportSet, str]:
    # Extracts imports and code body from source code

def build_script(files: List[Union[str, Path]], base_path: Optional[Path] = None, preserve_comments: bool = True) -> str:
    # Builds a single script from multiple Python files with proper dependency ordering

def generate_script(input_path: Union[str, Path], output_path: Optional[str] = None, preserve_comments: bool = True) -> Optional[str]:
    # Generates a single script from a Python file or directory
```

---

### `uv_wrapper.py`

```python
def generate_script(imports: Set[str], code: str) -> str:
    # Returns final script string with:
    # - Shebang
    # - OS check (bash or batch)
    # - uv install logic (curl or winget)
    # - uv add <packages>
    # - uv run path-to-script
    # - Embedded Python code
```

---

### `__main__.py`

```python
def main():
    # CLI interface for the packager
    # Usage: python -m packager package <input_path> -o <output_path> [--no-comments]
```

---

## Output Script Structure

```bash
#!/bin/bash
# Cross-platform uv bootstrap
OS=$(uname -s)

if [[ "$OS" == "Linux" || "$OS" == "Darwin" ]]; then
  if ! command -v uv >/dev/null; then
    echo "Installing uv..."
    if ! command -v curl >/dev/null; then
      echo "Missing 'curl'. Please install it."
      exit 1
    fi
    curl -LsSf https://astral.sh/uv/install.sh | sh
    export PATH="$HOME/.cargo/bin:$PATH"
  fi

  uv add rich typer requests
  uv run "$0" "$@"
  exit $?
fi

REM Windows fallback
@echo off
where uv >nul 2>nul
if %errorlevel% neq 0 (
  echo Installing uv using winget...
  winget install --id=astral-sh.uv -e
)

uv add rich typer requests
uv run "%~f0" %*
exit /b
```

_Followed by Python code:_

```python
#!/usr/bin/env python
# Standard library imports
import os
import sys

# Third-party imports
import typer
import requests

# Local imports
from my_package import utils

# Relative imports
from . import helpers

def main():
    print("Hello from bundled script!")

if __name__ == "__main__":
    main()
```

---

## Testing Strategy

Test Cases:

| Scenario                   | Linux | macOS | Windows |
| -------------------------- | ----- | ----- | ------- |
| No `uv` installed          |       |       |         |
| No `curl`                  |       |       | N/A     |
| No `winget`                | N/A   | N/A   |         |
| Missing dependency         |       |       |         |
| Nested import structure    |       |       |         |
| Works with entrypoint code |       |       |         |
| Dependency ordering        |       |       |         |
| Import categorization      |       |       |         |
| Comment preservation       |       |       |         |

---

## Requirements

| Tool        | Use                 |
| ----------- | ------------------- |
| `ast`       | Static parsing      |
| `uv`        | Runtime environment |
| `curl`      | Unix installer      |
| `winget`    | Windows installer   |
| Python 3.8+ | Runtime & toolchain |

---

## Future Improvements

- Package metadata injection (name/version/help)
- GUI/UX wrapper for non-devs
- Compression/minification support
- Add support for `.env` or config files
- Optional `pyproject.toml` parser for metadata
- Support for package-level imports
- Improved handling of relative imports

---

## Pathing

# Directory Structure

- ğŸ“ **./**
  - ğŸ“ **docs/**
    - ğŸ“„ **API_REFERENCE.md**
    - ğŸ“„ **INTEGRATION_GUIDE.md**
    - ğŸ“ **api/**
      - ğŸ“„ **core.md**
    - ğŸ“ **examples/**
      - ğŸ“ **game_sync/**
        - ğŸ“„ **.architecture.md**
    - ğŸ“ **guides/**
      - ğŸ“„ **integration.md**
  - ğŸ“ **erasmus/**
    - ğŸ“„ \***\*init**.py\*\*
    - ğŸ“„ \***\*main**.py\*\*
    - ğŸ“ **cli/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **commands.py**
      - ğŸ“„ **main.py**
      - ğŸ“„ **protocol.py**
      - ğŸ“„ **setup.py**
    - ğŸ“ **core/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **context.py**
      - ğŸ“„ **dynamic_updates.py**
      - ğŸ“„ **ide_integration.py**
      - ğŸ“„ **rule_applicator.py**
      - ğŸ“„ **rules.py**
      - ğŸ“„ **rules_parser.py**
      - ğŸ“„ **task.py**
      - ğŸ“„ **watcher.py**
    - ğŸ“„ **erasmus.py**
    - ğŸ“ **git/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **manager.py**
    - ğŸ“ **ide/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **cursor_integration.py**
      - ğŸ“„ **sync_integration.py**
    - ğŸ“ **sync/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **file_sync.py**
    - ğŸ“ **utils/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **context.py**
      - ğŸ“„ **env.py**
      - ğŸ“„ **env_manager.py**
      - ğŸ“„ **file.py**
      - ğŸ“„ **file_ops.py**
      - ğŸ“„ **logging.py**
      - ğŸ“„ **path_constants.py**
      - ğŸ“„ **paths.py**
      - ğŸ“ **protocols/**
        - ğŸ“„ \***\*init**.py\*\*
        - ğŸ“„ **agent_registry.json**
        - ğŸ“„ **base.py**
        - ğŸ“„ **cli.py**
        - ğŸ“„ **context.py**
        - ğŸ“„ **example.py**
        - ğŸ“„ **integration.py**
        - ğŸ“„ **manager.py**
        - ğŸ“„ **protocol_cli.py**
        - ğŸ“„ **server.py**
        - ğŸ“ **stored/**
          - ğŸ“„ **CI_CD Agent.md**
          - ğŸ“„ **Code Review Agent.md**
          - ğŸ“„ **Debug Agent.md**
          - ğŸ“„ **Dependency Agent.md**
          - ğŸ“„ **Developer Agent.md**
          - ğŸ“„ **Documentation Agent.md**
          - ğŸ“„ **Orchestration Agent.md**
          - ğŸ“„ **Performance Agent.md**
          - ğŸ“„ **Product Owner Agent.json**
          - ğŸ“„ **Product Owner Agent.md**
          - ğŸ“„ **Security Agent.md**
          - ğŸ“„ **Style Agent.md**
          - ğŸ“„ **Testing Agent.md**
          - ğŸ“„ **agent_workflow.md**
          - ğŸ“„ **cidc.md**
          - ğŸ“„ **code_review.md**
          - ğŸ“„ **debugging.md**
          - ğŸ“„ **dependency.md**
          - ğŸ“„ **developer.md**
          - ğŸ“„ **documentation.md**
          - ğŸ“„ **orchestration.md**
          - ğŸ“„ **performance.md**
          - ğŸ“„ **product_owner.md**
          - ğŸ“„ **security.md**
          - ğŸ“„ **style.md**
          - ğŸ“„ **testing.md**
      - ğŸ“„ **protocols.py**
  - ğŸ“„ **erasmus.py**
  - ğŸ“„ **.progress.md**
  - ğŸ“ **public/**
    - ğŸ“„ **flowchart.png**
  - ğŸ“„ **pyproject.toml**
  - ğŸ“ **scripts/**
    - ğŸ“„ **cleanup.sh**
    - ğŸ“„ **setup_gamesync_demo.sh**
    - ğŸ“ **test/**
      - ğŸ“„ **test_installer.sh**
  - ğŸ“ **src/**
    - ğŸ“„ **collector.py**
    - ğŸ“„ **stdlib.py**
  - ğŸ“„ **.tasks.md**
  - ğŸ“ **templates/**
    - ğŸ“„ **.architecture.md**
    - ğŸ“„ **.progress.md**
    - ğŸ“„ **.tasks.md**
  - ğŸ“ **tests/**
    - ğŸ“„ \***\*init**.py\*\*
    - ğŸ“ **benchmarks/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **test_memory_usage.py**
      - ğŸ“„ **test_sync_performance.py**
    - ğŸ“ **cli/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **test_setup.py**
    - ğŸ“„ **conftest.py**
    - ğŸ“ **core/**
      - ğŸ“„ \***\*init**.py\*\*
      - ğŸ“„ **test_context.py**
      - ğŸ“„ **test_dynamic_updates.py**
      - ğŸ“„ **test_rule_applicator.py**
      - ğŸ“„ **test_rules.py**
      - ğŸ“„ **test_rules_parser.py**
      - ğŸ“„ **test_task.py**
      - ğŸ“„ **test_watcher.py**
      - ğŸ“„ **test_watcher_integration.py**
    - ğŸ“ **git/**
      - ğŸ“„ \***\*init**.py\*\*
    - ğŸ“ **ide/**
      - ğŸ“„ **test_cursor_integration.py**
      - ğŸ“„ **test_sync_integration.py**
    - ğŸ“ **packager/**
      - ğŸ“„ **test_collector.py**
      - ğŸ“„ **test_stdlib.py**
    - ğŸ“ **sync/**
      - ğŸ“„ **test_file_sync.py**
    - ğŸ“„ **test_file_sync.py**
    - ğŸ“„ **test_git_commits.py**
    - ğŸ“„ **test_git_manager.py**
    - ğŸ“„ **test_utils.py**
    - ğŸ“ **utils/**
      - ğŸ“„ \***\*init**.py\*\*
  - ğŸ“„ **README.md**
  - ğŸ“„ **uv.lock**
  - ğŸ“„ **version.json**
  - ğŸ“„ **walk.py**

## Summary

This Python packager is a **fully cross-platform script bundler** that requires:

- No setup
- No environments
- No external files

It outputs a **single script** that:

- Bootstraps its dependencies using `uv`
- Installs `uv` if necessary
- Runs itself cleanly on any modern system
