# Development Tasks

## Current Issues

### Constructor Argument Errors [HIGH PRIORITY]

- [ ] Fix FileSynchronizer constructor

  - [ ] Update to accept 3 arguments instead of 2 (affects 7 tests)

  ```
  TypeError: FileSynchronizer.__init__() takes 2 positional arguments but 3 were given
  ```

  - [ ] Fix test_large_number_of_files_memory
  - [ ] Fix test_initial_sync_memory
  - [ ] Fix test_repeated_sync_memory
  - [ ] Fix test_status_check_memory
  - [ ] Fix test_sync_single_file_performance
  - [ ] Fix test_sync_all_files_performance
  - [ ] Fix test_concurrent_sync_performance

- [ ] Fix ProtocolManager constructor
  - [ ] Update to accept 4 arguments instead of 1 (affects 5 tests)
  ```
  TypeError: ProtocolManager.__init__() takes 1 positional argument but 4 were given
  ```
  - [ ] Fix test_initial_sync
  - [ ] Fix test_file_change_sync
  - [ ] Fix test_context_change_sync
  - [ ] Fix test_concurrent_changes
  - [ ] Fix test_error_handling

### Packager Return Value Errors [HIGH PRIORITY]

- [ ] Fix CLI command return values

  - [ ] Fix test_package_single_file (assert 1 == 0)
  - [ ] Fix test_package_directory (assert 1 == 0)
  - [ ] Fix test_package_no_output (assert 1 == 0)
  - [ ] Fix test_package_no_comments (assert 2 == 0)
  - [ ] Fix test_package_custom_build_dir (assert 2 == 0)
  - [ ] Fix test_list_files_invalid_dir (assert 2 == 1)

- [ ] Fix Main module return values
  - [ ] Fix test_package_project (assert 1 == 0)
  - [ ] Fix test_package_with_output (assert 1 == 0)
  - [ ] Fix test_package_no_group_imports (assert 2 == 0)
  - [ ] Fix test_package_verbose (assert 1 == 0)
  - [ ] Fix test_package_invalid_file (assert 1 == 2)
  - [ ] Fix test_package_non_python_file (assert 1 == 2)
  - [ ] Fix test_package_output_files (assert 1 == 0)

### Error Message Assertions [MEDIUM PRIORITY]

- [ ] Fix missing error messages
  - [ ] Fix test_package_invalid_input (assert 'Error' in '')
  - [ ] Fix test_package_nonexistent_path (assert 'does not exist' in '')
  - [ ] Fix test_package_empty_directory (assert 'No Python files found' in '')

### Parser and Import Issues [MEDIUM PRIORITY]

- [ ] Fix import extraction
  - [ ] Fix test_extract_imports (assert 'module' in {'module.\*', 'numpy', 'pandas.DataFrame'})
  - [ ] Fix test_extract_imports_with_errors (assert 'os' in set())

### Error Handling [MEDIUM PRIORITY]

- [ ] Fix error handling in file sync
  - [ ] Fix test_handle_permission_error (Failed: DID NOT RAISE PermissionError)
  - [ ] Fix test_sync_file_runtime_error (Failed: DID NOT RAISE RuntimeError)

### Git Integration [MEDIUM PRIORITY]

- [ ] Fix credential handling
  - [ ] Fix test_check_creds_with_default_key
  - [ ] Fix test_check_creds_with_openai_url
- [ ] Fix commit message generation
  - [ ] Fix test_make_atomic_commit_fallback
- [ ] Fix git staging
  - [ ] Fix test_stage_all_changes

### UV Wrapper Issues [LOW PRIORITY]

- [ ] Fix script generation
  - [ ] Fix test_generate_unix_script (TypeError: 'in <string>' requires string as left operand, not function)
  - [ ] Fix test_generate_windows_script
  - [ ] Fix test_generate_script_with_entry_point (TypeError: takes 1 positional argument but 2 were given)
  - [ ] Fix test_generate_script_invalid_os (Failed: DID NOT RAISE OSError)
  - [ ] Fix test_script_execution_order (RuntimeError: generator raised StopIteration)

### Miscellaneous [LOW PRIORITY]

- [ ] Fix test_collect_py_files_with_custom_exclude (assert 4 == 2)
- [ ] Fix test_cleanup_project (assert not True)

## Completed Components

### Cursor Integration [COMPLETED]

- [x] Fixed hanging test_queue_single_update

  - [x] Implemented proper queue management with task_done()
  - [x] Added queue.join() for update completion
  - [x] Improved error handling and event management

- [x] Fixed file change handling

  - [x] Added proper absolute path resolution
  - [x] Implemented file existence checks
  - [x] Added error handling for file operations

- [x] Fixed error handling and recovery

  - [x] Added JSONDecodeError handling
  - [x] Implemented state reset for invalid JSON
  - [x] Improved locking and event handling

- [x] Improved overall robustness
  - [x] Added proper status tracking
  - [x] Enhanced concurrent update handling
  - [x] Added comprehensive error logging

### `stdlib.py` [COMPLETED]

The `stdlib.py` module is responsible for detecting standard library modules to filter them from the dependencies that need to be installed.

### Tasks

#### 1. Research Standard Library Detection Methods

- [x] Research methods to detect Python standard library modules
- [x] Evaluate using `sys.stdlib_module_names` (Python 3.10+)
- [x] Evaluate using external packages like `stdlib-list`
- [x] Determine the most reliable cross-version approach

#### 2. Implement Core Detection Function

- [x] Implement `is_stdlib_module(name: str) -> bool` function
- [x] Handle edge cases (e.g., submodules like `os.path`)
- [x] Ensure compatibility with different Python versions

#### 3. Create Module-Level Cache

- [x] Implement caching mechanism for standard library modules
- [x] Ensure thread safety if necessary
- [x] Add initialization function to populate cache on module load

#### 4. Add Utility Functions

- [x] Implement `filter_stdlib_imports(imports: set[str]) -> set[str]` to filter a set of imports
- [x] Add helper functions for common operations

#### 5. Write Tests

- [x] Write unit tests for `is_stdlib_module`
- [x] Test with various standard library modules
- [x] Test with third-party modules
- [x] Test edge cases and submodules

#### 6. Documentation

- [x] Add module-level docstring
- [x] Document all functions with type hints
- [x] Add usage examples
- [x] Document limitations and edge cases

### `collector.py` [COMPLETED]

The `collector.py` module is responsible for recursively finding Python files in a project directory.

### Tasks

#### 1. Design File Collection Strategy

- [x] Determine approach for recursive directory traversal
- [x] Decide on handling of symlinks and special files
- [x] Plan for exclusion patterns (e.g., `.git`, `__pycache__`, etc.)

#### 2. Implement Core Collection Function

- [x] Implement `collect_py_files(base_path: str) -> list[str]` function
- [x] Add proper error handling for file system operations
- [x] Ensure cross-platform compatibility (Windows/Unix paths)

#### 3. Add Filtering Capabilities

- [x] Implement exclusion patterns for directories
- [x] Add support for custom file extensions beyond `.py`
- [x] Create utility for filtering collected files

#### 4. Optimize Performance

- [x] Implement efficient traversal algorithm
- [x] Add caching if necessary for large projects
- [x] Consider parallel processing for large directories

#### 5. Write Tests

- [x] Write unit tests for file collection
- [x] Test with various directory structures
- [x] Test exclusion patterns
- [x] Test edge cases (empty directories, permission issues)

#### 6. Documentation

- [x] Add module-level docstring
- [x] Document all functions with type hints
- [x] Add usage examples
- [x] Document limitations and edge cases

## Current Component: `parser.py`

The `parser.py` module is responsible for parsing Python imports using AST and stripping import statements from code.

### Tasks

#### 1. Design Import Parsing Strategy

- [ ] Research AST module for parsing Python code
- [ ] Determine approach for identifying import statements
- [ ] Plan for handling different import formats (`import x`, `from x import y`, etc.)

#### 2. Implement Import Extraction

- [ ] Implement `extract_imports(source: str) -> set[str]` function
- [ ] Handle regular imports (`import x`)
- [ ] Handle from imports (`from x import y`)
- [ ] Handle relative imports (`from . import x`)

#### 3. Implement Code Stripping

- [ ] Implement `strip_imports(source: str) -> str` function
- [ ] Preserve line numbers for debugging
- [ ] Handle multi-line imports
- [ ] Preserve docstrings and comments

#### 4. Add Utility Functions

- [ ] Create function to parse imports from a file
- [ ] Add support for parsing multiple files
- [ ] Implement import normalization

#### 5. Write Tests

- [ ] Write unit tests for import extraction
- [ ] Test with various import formats
- [ ] Test code stripping functionality
- [ ] Test edge cases (comments, docstrings, etc.)

#### 6. Documentation

- [ ] Add module-level docstring
- [ ] Document all functions with type hints
- [ ] Add usage examples
- [ ] Document limitations and edge cases

## Next Steps

1. Fix high priority issues first:
   - Constructor argument errors in FileSynchronizer and ProtocolManager
   - Packager CLI and main return values
2. Address medium priority issues:
   - Error message assertions
   - Parser and import extraction
   - File sync error handling
   - Git integration
3. Handle low priority issues:
   - UV wrapper script generation
   - Miscellaneous test failures
4. Complete remaining tasks:
   - Complete `parser.py` implementation
   - Add comprehensive test coverage
   - Review and update documentation
5. Consider additional features:
   - Package metadata injection
   - GUI wrapper
   - Compression/minification support
   - Optional pyproject.toml parser for metadata
